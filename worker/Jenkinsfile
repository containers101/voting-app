pipeline {
    agent any
    
    tools {
        maven 'maven'
    }
    stages{
        stage('build'){
            
            steps{
                echo "compiling worker app"
                dir('worker'){
                    sh 'mvn compile'
                }
                }
            }
        
         stage('test'){
     
            
            steps{
               echo "running unit tests" 
               dir('worker'){
                    sh 'mvn clean test'
                }
            }
        }
         stage('package'){
      
        
            steps{
                echo "packaging worker app"
                 dir('worker'){
                    sh 'mvn package -DskipTests'
                    archiveArtifacts artifacts: '**/target/*.jar', fingerprint: true
                }
            }
        }
    }
 post{    
     always{        
         echo 'Building multibranch pipeline for worker is completed..'    
         }    
         failiure{      
             slackSend (channel: "instavote-cd", message: "Build Failed - $
             {env.JOB_NAME} ${env.BUILD_NUMBER} (<${env.BUILD_URL}|Open>)")    
             } 
                success{      
                    slackSend (channel: "instavote-cd", message: "Build Succeeded - ${env.JOB_NAME} ${env.BUILD_NUMBER} (<${env.BUILD_URL}|Open>)") 
                       }  
                    }
                }
                      

    
    
// }

//       when{
//                  branch 'master'
//                  changeset "**/worker"